<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="icon" href="../../.././favicon.svg"></link><link rel="mask-icon" href="../../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>Mathlib.Tactic.Linter.FlexibleLinter</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="Mathlib.Tactic.Linter.FlexibleLinter";</script><script type="module" src="../../.././jump-src.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././expand-nav.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">Linter</span>.<span class="name">FlexibleLinter</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Init.html">Init</a></li><li><a href="../../.././Lean/Elab/Command.html">Lean.Elab.Command</a></li><li><a href="../../.././Mathlib/Tactic/Linter/Header.html">Mathlib.Tactic.Linter.Header</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Mathlib.Tactic.Linter.FlexibleLinter" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.linter.flexible"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">flexible</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.flexible?"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">flexible?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Elab.TacticInfo.goalsTargetedBy"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">TacticInfo</span>.<span class="name">goalsTargetedBy</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Elab.TacticInfo.goalsCreatedBy"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">TacticInfo</span>.<span class="name">goalsCreatedBy</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.extractCtxAndGoals"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">extractCtxAndGoals</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.Stained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">Stained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.instReprStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instReprStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.instInhabitedStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instInhabitedStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.instDecidableEqStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instDecidableEqStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.instHashableStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instHashableStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.instToStringStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instToStringStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.toStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">toStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.getStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">getStained</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.getStained!"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">getStained!</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.Stained.toFMVarId"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">Stained</span>.<span class="name">toFMVarId</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.stoppers"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">stoppers</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.flexible"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">flexible</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.usesGoal?"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">usesGoal?</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.getFVarIdCandidates"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">getFVarIdCandidates</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.persistFVars"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">persistFVars</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.reallyPersist"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">reallyPersist</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.Flexible.flexibleLinter"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">flexibleLinter</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="The-flexible-linter">The &quot;flexible&quot; linter <a class="hover-link" href="#The-flexible-linter">#</a></h1><p>The &quot;flexible&quot; linter makes sure that a &quot;rigid&quot; tactic (such as <code>rw</code>) does not act on the
output of a &quot;flexible&quot; tactic (such as <code>simp</code>).</p><p>For example, this ensures that, if you want to use <code>simp [...]</code> in the middle of a proof,
then you should replace <code>simp [...]</code> by one of</p><ul>
<li>a <code>suffices \&quot;expr after simp\&quot; by simpa</code> line;</li>
<li>the output of <code>simp? [...]</code>, so that the final code contains <code>simp only [...]</code>;</li>
<li>something else that does not involve <code>simp</code>!</li>
</ul><p>Otherwise, the linter will complain.</p><p>Simplifying and appealing to a geometric intuition, you can imagine a (tactic) proof like a
directed graph, where</p><ul>
<li>each node is a local hypothesis or a goal in some metavariable and</li>
<li>two hypotheses/goals are connected by an arrow if there is a tactic that modifies the source
of the arrow into the target (this does not apply well to all tactics, but it does apply to
a large number of them).
With this in mind, a tactic like <code>rw [lemma]</code> takes a <em>very specific</em> input and return a
<em>very predictable</em> output.
Such a tactic is &quot;rigid&quot;. Any tactic is rigid, unless it is in <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code> or <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.stoppers">stoppers</a></code>.
Conversely, a tactic like <code>simp</code> acts on a wide variety of inputs and returns an output that
is possibly unpredictable: if later modifications adds a <code>simp</code>-lemma or some internals of
<code>simp</code> changes, the output of <code>simp</code> may change as well.
Such a tactic is <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code>. Other examples are <code>split</code>, <code>abel</code>, <code>norm_cast</code>,...
Let's go back to the graph picture above.</li>
<li>✅️ [<code>rigid</code> --&gt; <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code>]
A sequence <code>rw [lemma]; simp</code> is unlikely to break, since <code>rw [lemma]</code> produces the same output
unless some <em>really major</em> change happens!</li>
<li>❌️ [<code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code> --&gt; <code>rigid</code>]
A sequence <code>simp; rw [lemma]</code> is instead more likely to break, since the goal after <code>simp</code> is
subject to change by even a small, likely, modification of the <code>simp</code> set.</li>
<li>✅️ [<code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code> --&gt; <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code>]
A sequence <code>simp; linarith</code> is also quite stable, since if <code>linarith</code> was able to close the
goal with a &quot;weaker&quot; <code>simp</code>, it will likely still be able to close the goal with a <code>simp</code>
that takes one further step.</li>
<li>✅️ [<code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code> --&gt; <code>stopper</code>]
Finally, a sequence <code>simp; ring_nf</code> is stable and, moreover, the output of <code>ring_nf</code> is a
&quot;normal form&quot;, which means that it is likely to produce an unchanged result, even if the initial
input is different from the proof in its initial form.
A stopper can be followed by a rigid tactic, &quot;stopping&quot; the spread of the flexible reach.</li>
</ul><p>What the linter does is keeping track of nodes that are connected by <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code> tactics and
makes sure that only <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible">flexible</a></code> or <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.stoppers">stoppers</a></code> follow them.
Such nodes are <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code>.
Whenever it reaches a <code>stopper</code> edge, the target node is no longer <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code> and it is
available again to <code>rigid</code> tactics.</p><p>Currently, the only tactics that &quot;start&quot; the bookkeeping are most forms of non-<code>only</code> <code>simp</code>s.
These are encoded by the <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.flexible?">flexible?</a></code> predicate.
Future modifications of the linter may increase the scope of the <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.flexible?">flexible?</a></code> predicate and
forbid a wider range of combinations.</p><h2 class="markdown-heading" id="TODO">TODO <a class="hover-link" href="#TODO">#</a></h2><p>The example</p><pre><code class="language-lean">example (h : 0 = 0) : <a href="../../.././Init/Prelude.html#True">True</a> := by
  simp at h
  assumption
</code></pre><p>should trigger the linter, since <code>assumption</code> uses <code>h</code> that has been &quot;stained&quot; by <code>simp at h</code>.
However, <code>assumption</code> contains no syntax information for the location <code>h</code>, so the linter in its
current form does not catch this.</p><h2 class="markdown-heading" id="Implementation-notes">Implementation notes <a class="hover-link" href="#Implementation-notes">#</a></h2><p>A large part of the code is devoted to tracking <code>FVar</code>s and <code>MVar</code>s between tactics.</p><p>For the <code>FVar</code>s, this follows the following heuristic:</p><ul>
<li>if the unique name of the <code>FVar</code> is preserved, then we use that;</li>
<li>otherwise, if the <code>userName</code> of the <code>FVar</code> is preserved, then we use that;</li>
<li>if neither is preserved, we drop the ball and stop tracking the <code>FVarId</code>.</li>
</ul><p>For the <code>MVar</code>s, we use the information of <code><a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo.goalsBefore">Lean.Elab.TacticInfo.goalsBefore</a></code> and
<code><a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo.goalsAfter">Lean.Elab.TacticInfo.goalsAfter</a></code>.
By looking at the <code>mvar</code>s that are either only &quot;before&quot; or only &quot;after&quot;, we focus on the
&quot;active&quot; goals.
We then propagate all the <code>FVarId</code>s that were present in the &quot;before&quot; goals to the &quot;after&quot; goals,
while leaving untouched the ones in the &quot;inert&quot; goals.</p></div><div class="decl" id="Mathlib.Linter.linter.flexible"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L96-L100">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.linter.flexible"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">flexible</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>The flexible linter makes sure that &quot;rigid&quot; tactics do not follow &quot;flexible&quot; tactics.</p></div></div><div class="decl" id="Mathlib.Linter.flexible?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L102-L112">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.flexible?"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">flexible?</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <a href="../../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.flexible?">flexible?</a> stx</code> is <code>true</code> if <code>stx</code> is syntax for a tactic that takes a &quot;wide&quot; variety of
inputs and modifies them in possibly unpredictable ways.</p><p>The prototypical flexible tactic is <code>simp</code>.
The prototypical non-flexible tactic <code>rw</code>.
<code>simp only</code> is also non-flexible.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.flexible?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h3 class="markdown-heading" id="Heuristics-for-determining-goals-goals-that-a-tactic-modifies-what-they-become">Heuristics for determining goals goals that a tactic modifies what they become <a class="hover-link" href="#Heuristics-for-determining-goals-goals-that-a-tactic-modifies-what-they-become">#</a></h3><p>The two definitions <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsTargetedBy">goalsTargetedBy</a></code>, <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsCreatedBy">goalsCreatedBy</a></code> extract a list of
<code>MVarId</code>s attempting to determine on which goals the tactic <code>t</code> is acting and what are the
resulting modified goals.
This is mostly based on the heuristic that the tactic will &quot;change&quot; an <code>MVarId</code>.</p></div><div class="decl" id="Lean.Elab.TacticInfo.goalsTargetedBy"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L128-L131">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsTargetedBy"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">TacticInfo</span>.<span class="name">goalsTargetedBy</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo">TacticInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">MVarId</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsTargetedBy">goalsTargetedBy</a> t</code> are the <code>MVarId</code>s before the <code>TacticInfo</code> <code>t</code> that &quot;disappear&quot; after it.
They should correspond to the goals in which the tactic <code>t</code> performs some action.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">t</span>.<a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsTargetedBy">goalsTargetedBy</a></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Data/List/Basic.html#List.filter">List.filter</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>) =&gt; <span class="fn"><a href="../../.././Init/Prelude.html#Decidable.decide">decide</a> <a href="../../.././Init/Prelude.html#Not">¬</a><span class="fn"><span class="fn">x</span>.<a href="../../.././Lean/Expr.html#Lean.MVarId.name">name</a></span> <a href="../../.././Init/Prelude.html#Membership.mem">∈</a> <span class="fn"><a href="../../.././Init/Data/List/Basic.html#List.map">List.map</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href="../../.././Lean/Expr.html#Lean.MVarId.name">name</a></span>)</span> <span class="fn"><span class="fn">t</span>.<a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo.goalsAfter">goalsAfter</a></span></span></span>)</span>
    <span class="fn"><span class="fn">t</span>.<a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo.goalsBefore">goalsBefore</a></span></span></li></ul></details><details id="instances-for-list-Lean.Elab.TacticInfo.goalsTargetedBy" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Elab.TacticInfo.goalsCreatedBy"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L133-L136">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsCreatedBy"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">TacticInfo</span>.<span class="name">goalsCreatedBy</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo">TacticInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">MVarId</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsCreatedBy">goalsCreatedBy</a> t</code> are the <code>MVarId</code>s after the <code>TacticInfo</code> <code>t</code> that were not present before.
They should correspond to the goals created or changed by the tactic <code>t</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">t</span>.<a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Lean.Elab.TacticInfo.goalsCreatedBy">goalsCreatedBy</a></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Data/List/Basic.html#List.filter">List.filter</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>) =&gt; <span class="fn"><a href="../../.././Init/Prelude.html#Decidable.decide">decide</a> <a href="../../.././Init/Prelude.html#Not">¬</a><span class="fn"><span class="fn">x</span>.<a href="../../.././Lean/Expr.html#Lean.MVarId.name">name</a></span> <a href="../../.././Init/Prelude.html#Membership.mem">∈</a> <span class="fn"><a href="../../.././Init/Data/List/Basic.html#List.map">List.map</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href="../../.././Lean/Expr.html#Lean.MVarId.name">name</a></span>)</span> <span class="fn"><span class="fn">t</span>.<a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo.goalsBefore">goalsBefore</a></span></span></span>)</span>
    <span class="fn"><span class="fn">t</span>.<a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.TacticInfo.goalsAfter">goalsAfter</a></span></span></li></ul></details><details id="instances-for-list-Lean.Elab.TacticInfo.goalsCreatedBy" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.extractCtxAndGoals"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L144-L166">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.extractCtxAndGoals"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">extractCtxAndGoals</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">take?</span> : <span class="fn"><a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <a href="../../.././Init/Prelude.html#Bool">Bool</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Lean.Elab.InfoTree</a> →
  <span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> (<a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <a href="../../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <a href="../../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span> <a href="../../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span>)</span></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.extractCtxAndGoals">extractCtxAndGoals</a> take? tree</code> takes as input a function <code>take? : Syntax → <a href="../../.././Init/Prelude.html#Bool">Bool</a></code> and
an <code>InfoTree</code> and returns the array of pairs <code>(stx, mvars)</code>,
where <code>stx</code> is a syntax node such that <code>take? stx</code> is <code>true</code> and
<code>mvars</code> indicates the goal state:</p><ul>
<li>the context before <code>stx</code></li>
<li>the context after <code>stx</code></li>
<li>a list of metavariables closed by <code>stx</code></li>
<li>a list of metavariables created by <code>stx</code></li>
</ul><p>A typical usage is to find the goals following a <code>simp</code> application.</p></div></div><div class="decl" id="Mathlib.Linter.Flexible.Stained"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L168-L177">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">Stained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././foundational_types.html">Type</a></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code> is the type of the stained locations: it can be</p><ul>
<li>a <code>Name</code> (typically of associated to the <code>FVarId</code> of a local declaration);</li>
<li>the goal (<code>⊢</code>);</li>
<li>the &quot;wildcard&quot; -- all the declaration in context (<code>*</code>).</li>
</ul><ul class="constructors"><li class="constructor" id="Mathlib.Linter.Flexible.Stained.name">name : <span class="fn"><a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></li><li class="constructor" id="Mathlib.Linter.Flexible.Stained.goal">goal : <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></li><li class="constructor" id="Mathlib.Linter.Flexible.Stained.wildcard">wildcard : <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></li></ul><details id="instances-for-list-Mathlib.Linter.Flexible.Stained" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.instReprStained"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L177-L177">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instReprStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instReprStained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Repr.html#Repr">Repr</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instReprStained">Mathlib.Linter.Flexible.instReprStained</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <a href="../../.././Init/Data/Repr.html#Repr.mk">{</a> <span class="fn">reprPrec</span> := <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#_private.Mathlib.Tactic.Linter.FlexibleLinter.0.Mathlib.Linter.Flexible.reprStained._@.Mathlib.Tactic.Linter.FlexibleLinter._hyg.567">Mathlib.Linter.Flexible.reprStained✝</a> <a href="../../.././Init/Data/Repr.html#Repr.mk">}</a></li></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.instInhabitedStained"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L177-L177">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instInhabitedStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instInhabitedStained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instInhabitedStained">Mathlib.Linter.Flexible.instInhabitedStained</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <a href="../../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.name">Mathlib.Linter.Flexible.Stained.name</a> <a href="../../.././Init/Prelude.html#Inhabited.default">default</a></span> <a href="../../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.instDecidableEqStained"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L177-L177">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instDecidableEqStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instDecidableEqStained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#DecidableEq">DecidableEq</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instDecidableEqStained">Mathlib.Linter.Flexible.instDecidableEqStained</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#_private.Mathlib.Tactic.Linter.FlexibleLinter.0.Mathlib.Linter.Flexible.decEqStained._@.Mathlib.Tactic.Linter.FlexibleLinter._hyg.703">Mathlib.Linter.Flexible.decEqStained✝</a></li></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.instHashableStained"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L177-L177">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instHashableStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instHashableStained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Hashable">Hashable</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instHashableStained">Mathlib.Linter.Flexible.instHashableStained</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <a href="../../.././Init/Prelude.html#Hashable.mk">{</a> <span class="fn">hash</span> := <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#_private.Mathlib.Tactic.Linter.FlexibleLinter.0.Mathlib.Linter.Flexible.hashStained._@.Mathlib.Tactic.Linter.FlexibleLinter._hyg.917">Mathlib.Linter.Flexible.hashStained✝</a> <a href="../../.././Init/Prelude.html#Hashable.mk">}</a></li></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.instToStringStained"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L179-L185">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.instToStringStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">instToStringStained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/ToString/Basic.html#ToString">ToString</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><p>Converting a <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code> to a <code><a href="../../.././Init/Prelude.html#String">String</a></code>:</p><ul>
<li>a <code>Name</code> is represented by the corresponding string;</li>
<li><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.goal">goal</a></code> is represented by <code>⊢</code>;</li>
<li><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.wildcard">wildcard</a></code> is represented by <code>*</code>.</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.toStained"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L187-L204">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.toStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">toStained</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <span class="fn"><a href="../../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.toStained">toStained</a> stx</code> scans the input <code>Syntax</code> <code>stx</code> extracting identifiers and atoms, making an effort
to convert them to <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code>.
The function is used to extract &quot;location&quot; information about <code>stx</code>: either explicit locations as in
<code>rw [] at locations</code> or implicit ones as <code>rw [h]</code>.</p><p>Whether or not what this function extracts really is a location will be determined by the linter
using data embedded in the <code>InfoTree</code>s.</p></div></div><div class="decl" id="Mathlib.Linter.Flexible.getStained"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L206-L217">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">getStained</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">stx</span> : <a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">all?</span> : <span class="fn"><a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <a href="../../.././Init/Prelude.html#Bool">Bool</a></span> := <span class="fn">fun (<span class="fn">x</span> : <a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>) =&gt; <a href="../../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained">getStained</a> stx</code> expects <code>stx</code> to be an argument of a node of <code>SyntaxNodeKind</code>
<code><a href="../../.././Init/Tactics.html#Lean.Parser.Tactic.location">Lean.Parser.Tactic.location</a></code>.
Typically, we apply <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained">getStained</a></code> to the output of <code>getLocs</code>.</p><p>See <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained!">getStained!</a></code> for a similar function.</p></div></div><div class="decl" id="Mathlib.Linter.Flexible.getStained!"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L219-L232">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained!"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">getStained!</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">stx</span> : <a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">all?</span> : <span class="fn"><a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <a href="../../.././Init/Prelude.html#Bool">Bool</a></span> := <span class="fn">fun (<span class="fn">x</span> : <a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>) =&gt; <a href="../../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained!">getStained!</a> stx</code> expects <code>stx</code> to be an argument of a node of <code>SyntaxNodeKind</code>
<code><a href="../../.././Init/Tactics.html#Lean.Parser.Tactic.location">Lean.Parser.Tactic.location</a></code>.
Typically, we apply <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained!">getStained!</a></code> to the output of <code>getLocs</code>.</p><p>It returns the <code>HashSet</code> of <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code> determined by the locations in <code>stx</code>.</p><p>The only difference with <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained">getStained</a> stx</code>, is that <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained!">getStained!</a></code> never returns <code>{}</code>:
if <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getStained">getStained</a> stx = {}</code>, then <code>getStained' stx = {.goal}</code>.</p><p>This means that tactics that do not have an explicit &quot;<code>at</code>&quot; in their syntax will be treated as
acting on the main goal.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.getStained!" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.Stained.toFMVarId"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L234-L247">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.toFMVarId"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">Stained</span>.<span class="name">toFMVarId</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">mv</span> : <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href="../../.././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a> → <span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> (<a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.toFMVarId">Stained.toFMVarId</a> mv lctx st</code> takes a metavariable <code>mv</code>, a local context <code>lctx</code> and
a <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained">Stained</a></code> <code>st</code> and returns the array of pairs <code>(FVarId, mv)</code>s that <code>lctx</code> assigns to <code>st</code>
(the second component is always <code>mv</code>):</p><ul>
<li>if <code>st</code> &quot;is&quot; a <code>Name</code>, returns the singleton of the <code>FVarId</code> with the name carried by <code>st</code>;</li>
<li>if <code>st</code> is <code>.<a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.goal">goal</a></code>, returns the singleton <code>#[default]</code>;</li>
<li>if <code>st</code> is <code>.<a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.wildcard">wildcard</a></code>, returns the array of all the <code>FVarId</code>s in <code>lctx</code> with also <code>default</code>
(to keep track of the <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.goal">goal</a></code>).</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.toFMVarId">Mathlib.Linter.Flexible.Stained.toFMVarId</a> <span class="fn">mv</span> <span class="fn">lctx</span> <span class="fn">(<a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.name">Mathlib.Linter.Flexible.Stained.name</a> <span class="fn">a</span>)</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><span class="fn"><span class="fn">lctx</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalContext.findFromUserName?">findFromUserName?</a></span> <span class="fn">a</span></span> with
  | <a href="../../.././Init/Prelude.html#Option.none">none</a> =&gt; <a href="../../.././Init/Prelude.html#List.toArray">#[</a><a href="../../.././Init/Prelude.html#List.toArray">]</a>
  | <span class="fn"><a href="../../.././Init/Prelude.html#Option.some">some</a> <span class="fn">decl</span></span> =&gt; <a href="../../.././Init/Prelude.html#List.toArray">#[</a><a href="../../.././Init/Prelude.html#Prod.mk">(</a><span class="fn"><span class="fn">decl</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalDecl.fvarId">fvarId</a></span><a href="../../.././Init/Prelude.html#Prod.mk">,</a> <span class="fn">mv</span><a href="../../.././Init/Prelude.html#Prod.mk">)</a><a href="../../.././Init/Prelude.html#List.toArray">]</a></span></li><li class="equation"><span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.toFMVarId">Mathlib.Linter.Flexible.Stained.toFMVarId</a> <span class="fn">mv</span> <span class="fn">lctx</span> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.goal">Mathlib.Linter.Flexible.Stained.goal</a></span> <a href="../../.././Init/Prelude.html#Eq">=</a> <a href="../../.././Init/Prelude.html#List.toArray">#[</a><a href="../../.././Init/Prelude.html#Prod.mk">(</a><a href="../../.././Init/Prelude.html#Inhabited.default">default</a><a href="../../.././Init/Prelude.html#Prod.mk">,</a> <span class="fn">mv</span><a href="../../.././Init/Prelude.html#Prod.mk">)</a><a href="../../.././Init/Prelude.html#List.toArray">]</a></li><li class="equation"><span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.toFMVarId">Mathlib.Linter.Flexible.Stained.toFMVarId</a> <span class="fn">mv</span> <span class="fn">lctx</span> <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.wildcard">Mathlib.Linter.Flexible.Stained.wildcard</a></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Data/Array/Basic.html#Array.map">Array.map</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>) =&gt; <a href="../../.././Init/Prelude.html#Prod.mk">(</a><span class="fn">x</span><a href="../../.././Init/Prelude.html#Prod.mk">,</a> <span class="fn">mv</span><a href="../../.././Init/Prelude.html#Prod.mk">)</a>)</span> <span class="fn">(<span class="fn"><span class="fn"><span class="fn">lctx</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalContext.getFVarIds">getFVarIds</a></span>.<a href="../../.././Init/Prelude.html#Array.push">push</a></span> <a href="../../.././Init/Prelude.html#Inhabited.default">default</a>)</span></span></li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.Stained.toFMVarId" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.stoppers"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L249-L277">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.stoppers"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">stoppers</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></div><p><code>SyntaxNodeKind</code>s that are mostly &quot;formatting&quot;: mostly they are ignored
because we do not want the linter to spend time on them.
The nodes that they contain will be visited by the linter anyway.
The nodes that <em>follow</em> them, though, will <em>not</em> be visited by the linter.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.stoppers" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.flexible"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L279-L303">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.flexible"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">flexible</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></div><p><code>SyntaxNodeKind</code>s that are allowed to follow a flexible tactic:
<code>simp</code>, <code>simp_all</code>, <code>simpa</code>, <code>dsimp</code>, <code>constructor</code>, <code><a href="../../.././Init/Prelude.html#congr">congr</a></code>, <code>done</code>, <code><a href="../../.././Init/Prelude.html#rfl">rfl</a></code>, <code>omega</code>, <code>abel</code>,
<code>ring</code>, <code>linarith</code>, <code>nlinarith</code>, <code>norm_cast</code>, <code>aesop</code>, <code>tauto</code>, <code>fun_prop</code>, <code>split</code>, <code>split_ifs</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.flexible" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.usesGoal?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L305-L318">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.usesGoal?"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">usesGoal?</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Lean.SyntaxNodeKind">Lean.SyntaxNodeKind</a> → <a href="../../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>By default, if a <code>SyntaxNodeKind</code> is not special-cased here, then the linter assumes that
the tactic will use the goal as well: this heuristic works well with <code>exact</code>, <code>refine</code>, <code>apply</code>.
For tactics such as <code>cases</code> this is not true: for these tactics, <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.usesGoal?">usesGoal?</a></code> yields `false.</p><details id="instances-for-list-Mathlib.Linter.Flexible.usesGoal?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.getFVarIdCandidates"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L320-L327">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getFVarIdCandidates"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">getFVarIdCandidates</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">fv</span> : <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href="../../.././Init/Prelude.html#Lean.Name">Lean.Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href="../../.././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getFVarIdCandidates">getFVarIdCandidates</a> fv <a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.Stained.name">name</a> lctx</code> takes an input an <code>FVarId</code>, a <code>Name</code> and a <code>LocalContext</code>.
It returns an array of guesses for a &quot;best fit&quot; <code>FVarId</code> in the given <code>LocalContext</code>.
The first entry of the array is the input <code>FVarId</code> <code>fv</code>, if it is present.
The next entry of the array is the <code>FVarId</code> with the given <code>Name</code>, if present.</p><p>Usually, the first entry of the returned array is &quot;the best approximation&quot; to <code>(fv, name)</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getFVarIdCandidates">Mathlib.Linter.Flexible.getFVarIdCandidates</a> <span class="fn">fv</span> <span class="fn">name</span> <span class="fn">lctx</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Init/Data/Array/Basic.html#Array.map">Array.map</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../../.././Lean/LocalContext.html#Lean.LocalDecl">Lean.LocalDecl</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalDecl.fvarId">fvarId</a></span>)</span> <span class="fn"><a href="../../.././Init/Prelude.html#List.toArray">#[</a><span class="fn"><span class="fn"><span class="fn">lctx</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalContext.find?">find?</a></span> <span class="fn">fv</span></span><a href="../../.././Init/Prelude.html#List.cons">,</a> <span class="fn"><span class="fn"><span class="fn">lctx</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalContext.findFromUserName?">findFromUserName?</a></span> <span class="fn">name</span></span><a href="../../.././Init/Prelude.html#List.toArray">]</a>.<a href="../../.././Init/Data/Array/Basic.html#Array.reduceOption">reduceOption</a></span></span></li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.getFVarIdCandidates" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><p>Tactics often change the name of the current <code>MVarId</code>, as well as the names of the <code>FVarId</code>s
appearing in their local contexts.
The function <code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.reallyPersist">reallyPersist</a></code> makes an attempt at &quot;tracking&quot; pairs <code>(fvar, mvar)</code> across a
simultaneous change represented by an &quot;old&quot; list of <code>MVarId</code>s and the corresponding
<code>MetavarContext</code> and a new one.</p><p>This arises in the context of the information encoded in the <code>InfoTree</code>s when processing a
tactic proof.</p></div><div class="decl" id="Mathlib.Linter.Flexible.persistFVars"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L340-L346">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.persistFVars"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">persistFVars</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">fv</span> : <a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">before </span><span class="fn">after</span> : <a href="../../.././Lean/LocalContext.html#Lean.LocalContext">Lean.LocalContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.persistFVars">persistFVars</a></code> is one step in persisting: track a single <code>FVarId</code> between two <code>LocalContext</code>s.
If an <code>FVarId</code> with the same unique name exists in the new context, use it.
Otherwise, if an <code>FVarId</code> with the same <code>userName</code> exists in the new context, use it.
If both of these fail, return <code>default</code> (i.e. &quot;fail&quot;).</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.persistFVars">Mathlib.Linter.Flexible.persistFVars</a> <span class="fn">fv</span> <span class="fn">before</span> <span class="fn">after</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn">(<a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.getFVarIdCandidates">Mathlib.Linter.Flexible.getFVarIdCandidates</a> <span class="fn">fv</span> <span class="fn"><span class="fn">(<span class="fn"><span class="fn">(<span class="fn"><span class="fn">before</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalContext.find?">find?</a></span> <span class="fn">fv</span>)</span>.<a href="../../.././Init/Prelude.html#Option.getD">getD</a></span> <a href="../../.././Init/Prelude.html#Inhabited.default">default</a>)</span>.<a href="../../.././Lean/LocalContext.html#Lean.LocalDecl.userName">userName</a></span> <span class="fn">after</span>)</span>.<a href="../../.././Init/Prelude.html#Array.getD">getD</a></span> <span class="fn">0</span> <a href="../../.././Init/Prelude.html#Inhabited.default">default</a></span></li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.persistFVars" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.reallyPersist"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L348-L369">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.reallyPersist"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">reallyPersist</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">fmvars</span> : <span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> (<a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">mvs0 </span><span class="fn">mvs1</span> : <span class="fn"><a href="../../.././Init/Prelude.html#List">List</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx0 </span><span class="fn">ctx1</span> : <a href="../../.././Lean/MetavarContext.html#Lean.MetavarContext">Lean.MetavarContext</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> (<a href="../../.././Lean/Expr.html#Lean.FVarId">Lean.FVarId</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <a href="../../.././Lean/Expr.html#Lean.MVarId">Lean.MVarId</a>)</span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.reallyPersist">reallyPersist</a></code> converts an array of pairs <code>(fvar, mvar)</code> to another array of the same type.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.reallyPersist" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.Flexible.flexibleLinter"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/15e31b9dbf80fe0a2fcdf0eef4630bd80409b5f1/Mathlib/Tactic/Linter/FlexibleLinter.lean#L371-L420">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/FlexibleLinter.html#Mathlib.Linter.Flexible.flexibleLinter"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">Flexible</span>.<span class="name">flexibleLinter</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Elab/Command.html#Lean.Elab.Command.Linter">Lean.Linter</a></div></div><p>The main implementation of the flexible linter.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.Flexible.flexibleLinter" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>